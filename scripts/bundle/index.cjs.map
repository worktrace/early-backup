{"version":3,"file":"index.cjs","sources":["index.ts"],"sourcesContent":["import { readFileSync } from \"node:fs\"\nimport { join } from \"node:path\"\n\nexport interface ExportPaths {\n  /**\n   * This field is not defined in package.json specification,\n   * but required by this package to tell the compiler where the entry is.\n   */\n  source: string\n  cjs: string\n  esm: string\n  dts: string\n}\n\n/**\n * There might be one or more layer of export path defines.\n * @param root path to the root folder where package.json locates.\n */\nexport function parseExportPaths(root: string): ExportPaths[] {\n  const manifest = readFileSync(join(root, \"package.json\")).toString()\n  const exports = JSON.parse(manifest)[\"exports\"]\n\n  /**\n   * Parse a single layer of path configuration:\n   * All properties must be satisfied when using this package.\n   */\n  const parseSingleLayer = (item: unknown): ExportPaths | null => {\n    if (typeof item !== \"object\" || item === null) return null\n    const source = item[\"source\"]\n    const esm = item[\"import\"]\n    const cjs = item[\"require\"]\n    const dts = item[\"types\"]\n    if (typeof source !== \"string\") return null\n    if (typeof esm !== \"string\") return null\n    if (typeof cjs !== \"string\") return null\n    if (typeof dts !== \"string\") return null\n    return { source, esm, cjs, dts }\n  }\n\n  // Only a single layer define in the root.\n  const rootItem = parseSingleLayer(exports)\n  if (rootItem) return [rootItem]\n\n  // Resolve multiple entries.\n  const handler: ExportPaths[] = []\n  for (const [_key, value] of Object.entries(exports)) {\n    const item = parseSingleLayer(value)\n    if (item) handler.push(item)\n  }\n  return handler\n}\n"],"names":["root","manifest","readFileSync","join","toString","exports","JSON","parse","parseSingleLayer","item","source","esm","cjs","dts","rootItem","handler","_key","value","Object","entries","push"],"mappings":"sFAkBM,SAA2BA,GAC/B,MAAMC,EAAWC,EAAAA,aAAaC,EAAAA,KAAKH,EAAM,iBAAiBI,WACpDC,EAAUC,KAAKC,MAAMN,GAAmB,QAMxCO,EAAoBC,IACxB,GAAoB,iBAATA,GAA8B,OAATA,EAAe,OAAO,KACtD,MAAMC,EAASD,EAAa,OACtBE,EAAMF,EAAa,OACnBG,EAAMH,EAAc,QACpBI,EAAMJ,EAAY,MACxB,MAAsB,iBAAXC,GACQ,iBAARC,GACQ,iBAARC,GACQ,iBAARC,EAH4B,KAIhC,CAAEH,SAAQC,MAAKC,MAAKC,QAIvBC,EAAWN,EAAiBH,GAClC,GAAIS,EAAU,MAAO,CAACA,GAGtB,MAAMC,EAAyB,GAC/B,IAAK,MAAOC,EAAMC,KAAUC,OAAOC,QAAQd,GAAU,CACnD,MAAMI,EAAOD,EAAiBS,GAC1BR,GAAMM,EAAQK,KAAKX,GAEzB,OAAOM,CACT"}